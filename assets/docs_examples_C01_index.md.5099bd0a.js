import{o as n,c as s,e as a}from"./app.2c18be1c.js";const t='{"title":"终端程序","description":"","frontmatter":{},"relativePath":"docs/examples/C01/README.md","lastUpdated":1631590646352}',p={},o=[a('<h1 id="终端程序" tabindex="-1">终端程序 <a class="header-anchor" href="#终端程序" aria-hidden="true">#</a></h1><ol><li>工作于 <strong>playground</strong> 目录</li><li>安装 @swtc/lib</li><li>生成文件 <strong>index.js</strong> , 目录结构和内容如下</li></ol><div class="language-bash"><pre><code>$ tree\n<span class="token builtin class-name">.</span>\n└── index.js\n</code></pre></div><div class="language-javascript"><pre><code><span class="token string">&quot;use strict&quot;</span>\n\n<span class="token comment">// 引用@swtc/lib库</span>\n<span class="token keyword">const</span> Wallet <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@swtc/lib&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Wallet\n<span class="token keyword">const</span> Remote <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@swtc/lib&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Remote\n\n<span class="token keyword">const</span> remote <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Remote</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> currency_swt <span class="token operator">=</span> remote<span class="token punctuation">.</span><span class="token function">makeCurrency</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> currency_cny <span class="token operator">=</span> remote<span class="token punctuation">.</span><span class="token function">makeCurrency</span><span class="token punctuation">(</span><span class="token string">&quot;CNY&quot;</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> swt_vs_cny <span class="token operator">=</span> <span class="token punctuation">{</span> limit<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> gets<span class="token operator">:</span> currency_swt<span class="token punctuation">,</span> pays<span class="token operator">:</span> currency_cny <span class="token punctuation">}</span>\n\n<span class="token comment">// 收到ROUND次数的帐本后结束程序</span>\n<span class="token keyword">const</span> <span class="token constant">ROUND</span> <span class="token operator">=</span> <span class="token number">20</span>\n<span class="token keyword">var</span> round <span class="token operator">=</span> <span class="token number">0</span>\n<span class="token comment">// 定义查询价格的函数</span>\n<span class="token keyword">const</span> <span class="token function-variable function">query_price</span> <span class="token operator">=</span> <span class="token parameter">remote</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  remote\n    <span class="token punctuation">.</span><span class="token function">requestOrderBook</span><span class="token punctuation">(</span>swt_vs_cny<span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">submitPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">orderbooks</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      orderbooks<span class="token punctuation">.</span>offers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">offer</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> quantity <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>offer<span class="token punctuation">.</span>TakerPays<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000000</span><span class="token punctuation">)</span>\n        <span class="token keyword">let</span> price <span class="token operator">=</span>\n          Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1000000</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">Number</span><span class="token punctuation">(</span>offer<span class="token punctuation">.</span>quality<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100000</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">价格: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>price<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\t挂单量: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>quantity<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\t</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>offer<span class="token punctuation">.</span>Account<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\\n查询挂单出错了 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 每十秒钟生成一个钱包并且打印出来</span>\n<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> wallet <span class="token operator">=</span> Wallet<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\\n...新钱包...&quot;</span><span class="token punctuation">)</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>wallet<span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span>\n\n<span class="token comment">// 连接到服务器</span>\nremote\n  <span class="token punctuation">.</span><span class="token function">connectPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">server_info</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 连接成功</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\\n...服务器信息...&quot;</span><span class="token punctuation">)</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>server_info<span class="token punctuation">)</span>\n    <span class="token comment">// 订阅帐本变动</span>\n    remote<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;ledger_closed&quot;</span><span class="token punctuation">,</span> <span class="token parameter">ledger_data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\\n...最新帐本...&quot;</span><span class="token punctuation">)</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ledger_data<span class="token punctuation">)</span>\n      round<span class="token operator">++</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>round <span class="token operator">&gt;=</span> <span class="token constant">ROUND</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\\n...结束程序...&quot;</span><span class="token punctuation">)</span>\n        remote<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;已断开连接&quot;</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token comment">// 每10秒钟查询价格</span>\n    <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query_price</span><span class="token punctuation">(</span>remote<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>\n</code></pre></div><ol start="4"><li>脚本式运行</li></ol><div class="language-bash"><pre><code>$ node index.js\n</code></pre></div>',6)];p.render=function(a,t,p,c,e,u){return n(),s("div",null,o)};export{t as __pageData,p as default};
