import{o as n,c as s,e as a}from"./app.2c18be1c.js";const t='{"title":"Angular Web 应用","description":"","frontmatter":{},"headers":[{"level":2,"title":"准备","slug":"准备"}],"relativePath":"docs/examples/W06/index.md","lastUpdated":1631590647414}',p={},o=[a('<h1 id="angular-web-应用" tabindex="-1">Angular Web 应用 <a class="header-anchor" href="#angular-web-应用" aria-hidden="true">#</a></h1><h2 id="准备" tabindex="-1">准备 <a class="header-anchor" href="#准备" aria-hidden="true">#</a></h2><ol><li>进入 playground 目录.</li></ol><div class="language-bash"><pre><code>$ <span class="token builtin class-name">cd</span> playground\n</code></pre></div><ol start="2"><li>由于 angular-cli 创建纯粹的 web 应用，没有使用 webpack，我们找一个模版</li></ol><div class="language-bash"><pre><code>$ <span class="token function">git</span> clone git@github.com:muweigg/ng7.git\n</code></pre></div><ol start="3"><li>进入目录，该模版使用 webpack</li></ol><div class="language-bash"><pre><code>$ <span class="token builtin class-name">cd</span> ng7\n</code></pre></div><ol start="4"><li>安装@swtc/lib</li></ol><div class="language-bash"><pre><code>$ <span class="token function">npm</span> <span class="token function">install</span> @swtc/lib\n</code></pre></div><ol start="5"><li>启动开发服务器</li></ol><div class="language-bash"><pre><code>$ <span class="token function">npm</span> run serv\n</code></pre></div><ol start="6"><li>浏览器访问</li><li>默认页面内容文件 <code>src/app/modules/home/home.component.html</code> 如下</li></ol><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../../../assets/images/angular.png<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>\n    {{ title }}\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>\n    this is a lazy load module.\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n</code></pre></div><p>修改为如下示例内容</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../../../assets/images/angular.png<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>钱包<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span> <span class="token punctuation">/&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">&gt;</span></span>{{ wallet_text }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>帐本<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span> <span class="token punctuation">/&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">&gt;</span></span>{{ ledger_text }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>价格<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span> <span class="token punctuation">/&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">&gt;</span></span>{{ price_text }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n</code></pre></div><ol start="8"><li>对应 typescript 脚本为 <code>src/app/modules/home/home.component.ts</code>, 内容</li></ol><div class="language-typescript"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> OnInit <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/core&quot;</span>\n<span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  selector<span class="token operator">:</span> <span class="token string">&quot;home&quot;</span><span class="token punctuation">,</span>\n  templateUrl<span class="token operator">:</span> <span class="token string">&quot;./home.component.html&quot;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HomeComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>\n  title<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string">&quot;app works!&quot;</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre></div><p>修改为</p><div class="language-typescript"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> OnInit <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@angular/core&#39;</span><span class="token punctuation">;</span>\n\n<span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  selector<span class="token operator">:</span> <span class="token string">&#39;home&#39;</span><span class="token punctuation">,</span>\n  templateUrl<span class="token operator">:</span> <span class="token string">&#39;./home.component.html&#39;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HomeComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>\n\n  title<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string">&quot;app works!&quot;</span><span class="token punctuation">;</span>\n\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>wallet <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>ledger <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>wallet_text <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>ledger_text <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>price_text <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> SwtcLib <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&#39;@swtc/lib&#39;</span><span class="token punctuation">)</span>\n    <span class="token keyword">const</span> Wallet <span class="token operator">=</span> SwtcLib<span class="token punctuation">.</span>Wallet\n    <span class="token keyword">const</span> Remote <span class="token operator">=</span> SwtcLib<span class="token punctuation">.</span>Remote\n    <span class="token keyword">const</span> remote <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Remote</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">const</span> currency_swt <span class="token operator">=</span> remote<span class="token punctuation">.</span><span class="token function">makeCurrency</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">const</span> currency_cny <span class="token operator">=</span> remote<span class="token punctuation">.</span><span class="token function">makeAmount</span><span class="token punctuation">(</span><span class="token string">&#39;CNY&#39;</span><span class="token punctuation">)</span>\n    <span class="token keyword">const</span> swt_vs_cny <span class="token operator">=</span> <span class="token punctuation">{</span> limit<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> gets<span class="token operator">:</span> currency_swt<span class="token punctuation">,</span> pays<span class="token operator">:</span> currency_cny <span class="token punctuation">}</span>\n    <span class="token comment">// 收到ROUND次数的帐本后结束程序</span>\n    <span class="token keyword">const</span> <span class="token constant">ROUND</span> <span class="token operator">=</span> <span class="token number">20</span>\n    <span class="token keyword">var</span> round <span class="token operator">=</span> <span class="token number">0</span>\n    <span class="token comment">// 定义查询价格的函数</span>\n    <span class="token keyword">const</span> <span class="token function-variable function">query_price</span> <span class="token operator">=</span> <span class="token punctuation">(</span>remote<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>  remote<span class="token punctuation">.</span><span class="token function">requestOrderBook</span><span class="token punctuation">(</span>swt_vs_cny<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">submitPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>orderbooks <span class="token operator">-=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>\n           <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\\n...出价...&quot;</span><span class="token punctuation">)</span>\n           orderbooks<span class="token punctuation">.</span>offers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> offer <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n             <span class="token keyword">let</span> quantity <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>offer<span class="token punctuation">.</span>TakerPays <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000000</span><span class="token punctuation">)</span>\n             <span class="token keyword">let</span> price <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token number">1000000</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">/</span> <span class="token function">Number</span><span class="token punctuation">(</span>offer<span class="token punctuation">.</span>quality<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100000</span>\n             <span class="token keyword">this</span><span class="token punctuation">.</span>price<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\\n价格: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>price<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\t挂单量: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>quantity<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\t</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>offer<span class="token punctuation">.</span>Account<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n           <span class="token punctuation">}</span><span class="token punctuation">)</span>\n           <span class="token keyword">this</span><span class="token punctuation">.</span>price<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>\n           <span class="token keyword">this</span><span class="token punctuation">.</span>price_text <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>price<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;\\n&#39;</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>error<span class="token punctuation">)</span>\n    <span class="token comment">// 生成一个钱包并且之后每十秒更新</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>wallet <span class="token operator">=</span> Wallet<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>wallet_text <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>wallet<span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>\n    <span class="token function">setInterval</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>wallet <span class="token operator">=</span> Wallet<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\\n...新钱包...&quot;</span><span class="token punctuation">)</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>wallet_text <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>wallet<span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10000</span>\n    <span class="token punctuation">)</span>\n    <span class="token comment">// 连接到服务器</span>\n    remote<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>error<span class="token punctuation">,</span> server_info<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 连接出错</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 连接成功</span>\n          <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\\n...服务器信息...&quot;</span><span class="token punctuation">)</span>\n          <span class="token comment">// 订阅帐本变动</span>\n          remote<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;ledger_closed&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ledger_data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n              <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\\n...最新帐本...&quot;</span><span class="token punctuation">)</span>\n              <span class="token keyword">this</span><span class="token punctuation">.</span>ledger <span class="token operator">=</span> ledger_data\n              <span class="token keyword">this</span><span class="token punctuation">.</span>ledger_text <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ledger<span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>\n              round <span class="token operator">+=</span> <span class="token number">1</span>\n              <span class="token keyword">if</span> <span class="token punctuation">(</span> round <span class="token operator">&gt;=</span> <span class="token constant">ROUND</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\\n...结束程序...&quot;</span><span class="token punctuation">)</span>\n                remote<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;已断开连接&quot;</span><span class="token punctuation">)</span>\n              <span class="token punctuation">}</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">)</span>\n          <span class="token comment">// 查询价格每10秒钟更新</span>\n          <span class="token function">query_price</span><span class="token punctuation">(</span>remote<span class="token punctuation">)</span>\n          <span class="token function">setInterval</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query_price</span><span class="token punctuation">(</span>remote<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token number">9.</span> 页面应该正常了\n</code></pre></div>',20)];p.render=function(a,t,p,c,e,l){return n(),s("div",null,o)};export{t as __pageData,p as default};
